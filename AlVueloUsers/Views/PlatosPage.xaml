<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AlVueloUsers.Views.PlatosPage"
             BackgroundColor="#FFFFFF"
             NavigationPage.HasNavigationBar="False">

    <Grid RowDefinitions="Auto,Auto,Auto,*,Auto"
      RowSpacing="0">
        <!-- HEADER -->
        <Grid Grid.Row="0"
              BackgroundColor="#FFFFFF"
              Padding="20,50,20,20">

            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="16">

                <!-- BotÃ³n Back -->
                <Frame WidthRequest="44"
                       HeightRequest="44"
                       CornerRadius="22"
                       BackgroundColor="#F8F8F8"
                       HasShadow="False"
                       Padding="0">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnBackTapped"/>
                    </Frame.GestureRecognizers>
                    <Label Text="&#xF060;"
                           FontFamily="FASolid"
                           FontSize="16"
                           TextColor="#1A1A1A"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Frame>

                <!-- Info Restaurante -->
                <HorizontalStackLayout Grid.Column="1" Spacing="12">

                    <Frame BackgroundColor="#FFF5F5"
                           CornerRadius="20"
                           HasShadow="False"
                           WidthRequest="72"
                           HeightRequest="72"
                           Padding="8">
                        <Image x:Name="ImgLogoRest"
                               Aspect="AspectFit"/>
                    </Frame>

                    <VerticalStackLayout Spacing="4" VerticalOptions="Center">
                        <Label x:Name="LblNombreRest"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="#1A1A1A"/>

                        <Label x:Name="LblCampus"
                               FontSize="13"
                               TextColor="#666666"/>

                        <Label x:Name="LblHorario"
                               FontSize="13"
                               TextColor="#666666"/>
                    </VerticalStackLayout>

                </HorizontalStackLayout>

            </Grid>
        </Grid>

        <!-- BUSCADOR -->
        <Frame Grid.Row="1"
               BackgroundColor="#F8F8F8"
               CornerRadius="24"
               HasShadow="False"
               Margin="20,0,20,16"
               Padding="0"
               HeightRequest="48">

            <Grid ColumnDefinitions="48,*" ColumnSpacing="0">
                <Label Text="&#xF002;"
                       FontFamily="FASolid"
                       FontSize="16"
                       TextColor="#999999"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>

                <Entry x:Name="EntryBuscar"
                       Grid.Column="1"
                       Placeholder="Buscar platillos..."
                       PlaceholderColor="#999999"
                       TextColor="#1A1A1A"
                       BackgroundColor="Transparent"
                       TextChanged="OnBuscarChanged"
                       FontSize="15"/>
            </Grid>
        </Frame>

        <!-- CATEGORÃAS -->
        <ScrollView Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalScrollBarVisibility="Never"
                    Padding="20,0,20,16">

            <CollectionView x:Name="ListaCategorias"
                            SelectionMode="Single">

                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Horizontal" ItemSpacing="12"/>
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="20"
                               HasShadow="False"
                               Padding="16,12"
                               MinimumWidthRequest="100"
                               BackgroundColor="#F8F8F8">

                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer
                                    Tapped="OnCategoriaTapped"
                                    CommandParameter="{Binding .}" />
                            </Frame.GestureRecognizers>

                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup Name="CommonStates">
                                    <VisualState Name="Normal">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="#F8F8F8"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState Name="Selected">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="#FF6B6B"/>
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>

                            <VerticalStackLayout Spacing="6" HorizontalOptions="Center">

                                <Label FontSize="28" HorizontalOptions="Center">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label" Binding="{Binding .}" Value="Desayunos">
                                            <Setter Property="Text" Value="ðŸ³"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding .}" Value="Almuerzos">
                                            <Setter Property="Text" Value="ðŸ½ï¸"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding .}" Value="Bebidas">
                                            <Setter Property="Text" Value="ðŸ¥¤"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding .}" Value="Postres">
                                            <Setter Property="Text" Value="ðŸ°"/>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding .}" Value="">
                                            <Setter Property="Text" Value="ðŸ½ï¸"/>
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>

                                <Label Text="{Binding .}"
                                       FontSize="13"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"
                                       TextColor="#666666">

                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup Name="CommonStates">
                                            <VisualState Name="Normal">
                                                <VisualState.Setters>
                                                    <Setter Property="TextColor" Value="#666666"/>
                                                </VisualState.Setters>
                                            </VisualState>
                                            <VisualState Name="Selected">
                                                <VisualState.Setters>
                                                    <Setter Property="TextColor" Value="#FFFFFF"/>
                                                </VisualState.Setters>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>

                                </Label>

                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>
        </ScrollView>

        <!-- LISTA DE PLATOS -->
        <CollectionView Grid.Row="3"
                        x:Name="ListaPlatos"
                        SelectionMode="None"
                        Margin="20,0">

            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical"
                                 Span="2"
                                 HorizontalItemSpacing="12"
                                 VerticalItemSpacing="16"/>
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame BackgroundColor="#FFFFFF"
                           CornerRadius="20"
                           HasShadow="True"
                           Padding="0"
                           Margin="0,4">

                        <Grid RowDefinitions="130,Auto" RowSpacing="0">

                            <!-- Imagen -->
                            <Grid Grid.Row="0">
                                <Frame BackgroundColor="#F2F2F2"
                                       CornerRadius="20"
                                       HasShadow="False"
                                       Padding="0">

                                    <Image Source="{Binding ImagenUrl}"
                                           Aspect="AspectFill"
                                           HeightRequest="130" />
                                </Frame>

                                <!-- fallback si no hay imagen -->
                                <Label Text="ðŸ½ï¸"
                                       FontSize="36"
                                       Opacity="0.35"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label"
                                                     Binding="{Binding ImagenUrl}"
                                                     Value="">
                                            <Setter Property="IsVisible" Value="True"/>
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>
                            </Grid>

                            <!-- Info + botÃ³n -->
                            <Grid Grid.Row="1"
                                  Padding="12"
                                  RowDefinitions="Auto,Auto"
                                  ColumnDefinitions="*,Auto"
                                  RowSpacing="6">

                                <Label Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                                       Text="{Binding Nombre}"
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="#1A1A1A"
                                       LineBreakMode="TailTruncation"
                                       MaxLines="2"/>

                                <Label Grid.Row="1" Grid.Column="0"
                                       Text="{Binding Precio, StringFormat='${0:F2}'}"
                                       FontAttributes="Bold"
                                       FontSize="16"
                                       TextColor="#FF6B6B"
                                       VerticalOptions="Center"/>

                                <!-- BotÃ³n + -->
                                <Frame Grid.Row="1" Grid.Column="1"
                                       BackgroundColor="#FF6B6B"
                                       CornerRadius="18"
                                       HasShadow="False"
                                       WidthRequest="36"
                                       HeightRequest="36"
                                       Padding="0"
                                       VerticalOptions="Center"
                                       HorizontalOptions="End">

                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer
                                            Tapped="OnAgregarPlatoTapped"
                                            CommandParameter="{Binding .}" />
                                    </Frame.GestureRecognizers>

                                    <Label Text="+"
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           TextColor="#FFFFFF"
                                           HorizontalOptions="Center"
                                           VerticalOptions="Center"/>
                                </Frame>

                            </Grid>

                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>
        <!-- BOTTOM BAR -->
        <Border Grid.Row="4"
        BackgroundColor="#FFFFFF"
        StrokeThickness="0"
        Padding="20,16,20,24">

            <Border.StrokeShape>
                <RoundRectangle CornerRadius="28"/>
            </Border.StrokeShape>

            <Border.Shadow>
                <Shadow Brush="#000000"
                Opacity="0.18"
                Radius="18"
                Offset="0,-6"/>
            </Border.Shadow>

            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="0">

                <!-- Home -->
                <VerticalStackLayout Spacing="4">
                    <VerticalStackLayout.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnHomeTapped"/>
                    </VerticalStackLayout.GestureRecognizers>

                    <Label Text="&#xF015;"
                   FontFamily="FASolid"
                   FontSize="24"
                   TextColor="#FF6B6B"
                   HorizontalOptions="Center"/>
                    <Label Text="Inicio"
                   FontSize="11"
                   TextColor="#FF6B6B"
                   HorizontalOptions="Center"/>
                </VerticalStackLayout>

                <!-- Carrito -->
                <VerticalStackLayout Grid.Column="1" Spacing="4">
                    <VerticalStackLayout.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnCarritoTapped"/>
                    </VerticalStackLayout.GestureRecognizers>

                    <Label Text="&#xF07A;"
                   FontFamily="FASolid"
                   FontSize="24"
                   TextColor="#CCCCCC"
                   HorizontalOptions="Center"/>
                    <Label Text="Carrito"
                   FontSize="11"
                   TextColor="#CCCCCC"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"/>
                </VerticalStackLayout>

                <!-- Favoritos -->
                <VerticalStackLayout Grid.Column="2" Spacing="4">
                    <Label Text="&#xF004;"
                   FontFamily="FASolid"
                   FontSize="24"
                   TextColor="#CCCCCC"
                   HorizontalOptions="Center"/>
                    <Label Text="Favoritos"
                   FontSize="11"
                   TextColor="#999999"
                   HorizontalOptions="Center"/>
                </VerticalStackLayout>

                <!-- Pedidos -->
                <VerticalStackLayout Grid.Column="3" Spacing="4">
                    <Label Text="&#xF0F3;"
                   FontFamily="FASolid"
                   FontSize="24"
                   TextColor="#CCCCCC"
                   HorizontalOptions="Center"/>
                    <Label Text="Pedidos"
                   FontSize="11"
                   TextColor="#999999"
                   HorizontalOptions="Center"/>
                </VerticalStackLayout>

            </Grid>
        </Border>

    </Grid>
</ContentPage>
