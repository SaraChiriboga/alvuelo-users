<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="AlVueloUsers.Views.PagoPage"
             BackgroundColor="{StaticResource AlVueloBg}">

    <Grid RowDefinitions="Auto, *, Auto">

        <!-- HEADER CON TÍTULO -->
        <Border Grid.Row="0" 
                BackgroundColor="White"
                Padding="20,15"
                StrokeThickness="0"
                Shadow="{Shadow Brush=Black, Offset='0,2', Radius=8, Opacity=0.08}">
            <Grid ColumnDefinitions="Auto, *">
                <Label FontFamily="FASolid" 
                       Text="&#xf07a;" 
                       TextColor="{StaticResource AlVueloRed}"
                       FontSize="24"
                       VerticalOptions="Center"
                       Margin="0,0,12,0"/>
                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                    <Label Text="Finalizar Pedido"
                           FontSize="20"
                           FontAttributes="Bold"
                           TextColor="#1a1a1a"/>
                    <Label Text="Revisa tu orden y método de pago"
                           FontSize="13"
                           TextColor="#666666"/>
                </VerticalStackLayout>
            </Grid>
        </Border>

        <!-- CONTENIDO SCROLLABLE -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="20">

                <!-- SECCIÓN: OPCIONES DE SERVICIO -->
                <VerticalStackLayout Spacing="12">
                    <HorizontalStackLayout Spacing="8">
                        <Label Text="Opciones de Servicio" 
                               Style="{StaticResource SectionHeaderStyle}"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <!-- Tarjeta contenedora de opciones -->
                    <Border
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 16"
                            Shadow="{Shadow Brush=Black, Offset='0,2', Radius=10, Opacity=0.06}">
                        <VerticalStackLayout Spacing="0">

                            <!-- Opción: Entrega en Campus -->
                            <Border Style="{StaticResource DeliveryOptionBorderStyle}" 
                                    x:Name="BorderCampus" 
                                    x:FieldModifier="public"
                                    Padding="16,14"
                                    StrokeThickness="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnServicioSelected" CommandParameter="Campus"/>
                                </Border.GestureRecognizers>

                                <Grid ColumnDefinitions="Auto, *, Auto">
                                    <Border Grid.Column="0"
                                            WidthRequest="40"
                                            HeightRequest="40"
                                            StrokeShape="RoundRectangle 10"
                                            BackgroundColor="#FFF5F5"
                                            Margin="0,0,12,0">
                                        <Label FontFamily="FASolid" 
                                               Text="&#xf21c;" 
                                               FontSize="18" 
                                               TextColor="{StaticResource AlVueloRed}"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </Border>

                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                        <Label Text="Entrega en campus" 
                                               FontAttributes="Bold"
                                               FontSize="15"
                                               TextColor="#1a1a1a"/>
                                        <Label x:Name="LabelTiempoEstimado" 
                                               Text="Selecciona tu campus"
                                               TextColor="{StaticResource TextSecondary}" 
                                               FontSize="13"/>
                                    </VerticalStackLayout>

                                    <Border Grid.Column="2" 
                                            BackgroundColor="#F8F8F8"
                                            StrokeShape="RoundRectangle 8"
                                            Padding="8,4"
                                            VerticalOptions="Center">
                                        <HorizontalStackLayout Spacing="6">
                                            <Picker x:Name="PickerCampus"
                                                    Style="{StaticResource PickerDropdownStyle}"
                                                    Title="Campus"
                                                    WidthRequest="90"
                                                    TextColor="#1a1a1a"
                                                    FontSize="13">
                                                <Picker.ItemsSource>
                                                    <x:Array Type="{x:Type x:String}">
                                                        <x:String>UdlaPark</x:String>
                                                        <x:String>Granados</x:String>
                                                        <x:String>Colón</x:String>
                                                    </x:Array>
                                                </Picker.ItemsSource>
                                            </Picker>
                                            <Label FontFamily="FASolid" 
                                                   Text="&#xf078;" 
                                                   FontSize="9" 
                                                   TextColor="{StaticResource AlVueloRed}" 
                                                   VerticalOptions="Center"
                                                   InputTransparent="True" />
                                        </HorizontalStackLayout>
                                    </Border>
                                </Grid>
                            </Border>

                            <BoxView HeightRequest="1" Color="#F0F0F0" Margin="16,0"/>

                            <!-- Opción: Retiro en Restaurante -->
                            <Border Style="{StaticResource DeliveryOptionBorderStyle}" 
                                    x:Name="BorderRetiro" 
                                    x:FieldModifier="public"
                                    Padding="16,14"
                                    StrokeThickness="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnServicioSelected" CommandParameter="Retiro"/>
                                </Border.GestureRecognizers>

                                <Grid ColumnDefinitions="Auto, *, Auto">
                                    <Border Grid.Column="0"
                                            WidthRequest="40"
                                            HeightRequest="40"
                                            StrokeShape="RoundRectangle 10"
                                            BackgroundColor="#FFF5F5"
                                            Margin="0,0,12,0">
                                        <Label FontFamily="FASolid" 
                                               Text="&#xf290;" 
                                               TextColor="{StaticResource AlVueloRed}" 
                                               FontSize="18"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </Border>

                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                        <Label Text="Retiro en Restaurante" 
                                               FontAttributes="Bold"
                                               FontSize="15"
                                               TextColor="#1a1a1a"/>
                                        <Label Text="Recoge en caja" 
                                               TextColor="{StaticResource TextSecondary}" 
                                               FontSize="13"/>
                                    </VerticalStackLayout>

                                    <Border Grid.Column="2"
                                            BackgroundColor="#F0F9FF"
                                            StrokeShape="RoundRectangle 8"
                                            Padding="10,6"
                                            VerticalOptions="Center">
                                        <Label Text="5-10 min" 
                                               FontSize="12"
                                               FontAttributes="Bold"
                                               TextColor="#0066CC"/>
                                    </Border>
                                </Grid>
                            </Border>

                            <BoxView HeightRequest="1" Color="#F0F0F0" Margin="16,0"/>

                            <!-- Opción: Consumo en Restaurante -->
                            <Border Style="{StaticResource DeliveryOptionBorderStyle}" 
                                    x:Name="BorderConsumo" 
                                    x:FieldModifier="public"
                                    Padding="16,14"
                                    StrokeThickness="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnServicioSelected" CommandParameter="Consumo"/>
                                </Border.GestureRecognizers>

                                <Grid ColumnDefinitions="Auto, *">
                                    <Border Grid.Column="0"
                                            WidthRequest="40"
                                            HeightRequest="40"
                                            StrokeShape="RoundRectangle 10"
                                            BackgroundColor="#FFF5F5"
                                            Margin="0,0,12,0">
                                        <Label FontFamily="FASolid" 
                                               Text="&#xf0ab;" 
                                               TextColor="{StaticResource AlVueloRed}" 
                                               FontSize="18"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center"/>
                                    </Border>

                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                        <Label Text="Consumo en Restaurante" 
                                               FontAttributes="Bold"
                                               FontSize="15"
                                               TextColor="#1a1a1a"/>
                                        <Label Text="Indica tu mesa al ordenar" 
                                               TextColor="{StaticResource TextSecondary}" 
                                               FontSize="13"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </Border>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>

                <!-- SECCIÓN: RESUMEN DE PAGO -->
                <VerticalStackLayout Spacing="12">
                    <HorizontalStackLayout Spacing="8">
                        <Label Text="Resumen de Pago" 
                               Style="{StaticResource SectionHeaderStyle}"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <Border BackgroundColor="White"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 16"
                            Padding="18"
                            Shadow="{Shadow Brush=Black, Offset='0,2', Radius=10, Opacity=0.06}">
                        <VerticalStackLayout Spacing="12">
                            <Grid ColumnDefinitions="*, Auto">
                                <Label Text="Productos" 
                                       TextColor="#666666"
                                       FontSize="14"/>
                                <Label Grid.Column="1" 
                                       Text="$0.96"
                                       FontSize="14"
                                       TextColor="#1a1a1a"/>
                            </Grid>

                            <Grid ColumnDefinitions="*, Auto">
                                <Label Text="Tarifa de servicio" 
                                       TextColor="#666666"
                                       FontSize="14"/>
                                <Label Grid.Column="1" 
                                       Text="$0.96"
                                       FontSize="14"
                                       TextColor="#1a1a1a"/>
                            </Grid>

                            <Grid ColumnDefinitions="*, Auto">
                                <Label Text="Envío" 
                                       TextColor="#666666"
                                       FontSize="14"/>
                                <Label x:Name="LabelEnvioAmount" 
                                       Grid.Column="1" 
                                       Text="$0.00"
                                       FontSize="14"
                                       TextColor="#1a1a1a"/>
                            </Grid>

                            <BoxView HeightRequest="1" Color="#E8E8E8" Margin="0,4"/>

                            <Grid ColumnDefinitions="*, Auto">
                                <Label Text="Total" 
                                       FontAttributes="Bold" 
                                       FontSize="18"
                                       TextColor="#1a1a1a"/>
                                <Label Grid.Column="1"
                                       Text="$7.54" 
                                       FontAttributes="Bold" 
                                       FontSize="20"
                                       TextColor="{StaticResource AlVueloRed}"/>
                            </Grid>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>

                <!-- SECCIÓN: MÉTODOS DE PAGO -->
                <VerticalStackLayout Spacing="12">
                    <HorizontalStackLayout Spacing="8">
                        <Label Text="Métodos de Pago" 
                               Style="{StaticResource SectionHeaderStyle}"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <Border BackgroundColor="White"
                            StrokeThickness="0"
                            StrokeShape="RoundRectangle 16"
                            Shadow="{Shadow Brush=Black, Offset='0,2', Radius=10, Opacity=0.06}">
                        <VerticalStackLayout Spacing="0">

                            <!-- Tarjeta -->
                            <Grid x:Name="GridMetodo_Tarjeta" 
                                  ColumnDefinitions="Auto, *, Auto" 
                                  Padding="16,12">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnMetodoPagoSelected" CommandParameter="Tarjeta"/>
                                </Grid.GestureRecognizers>

                                <Border x:Name="BorderIcon_Tarjeta" 
                                        WidthRequest="44"
                                        HeightRequest="44"
                                        StrokeShape="RoundRectangle 12"
                                        BackgroundColor="#FFF5F0"
                                        Stroke="#FFE5D9"
                                        StrokeThickness="1">
                                    <Image x:Name="IconoTarjeta" WidthRequest="24" HeightRequest="24">
                                        <Image.Source>
                                            <FontImageSource FontFamily="FABrands" 
                                                           Glyph="&#xf1f2;" 
                                                           Color="#FF6000" 
                                                           Size="22"/>
                                        </Image.Source>
                                    </Image>
                                </Border>

                                <Label x:Name="LabelNombreTarjeta" 
                                       Text="Mi Tarjeta •••• 1111" 
                                       Grid.Column="1" 
                                       VerticalOptions="Center" 
                                       Margin="14,0"
                                       FontSize="15"
                                       TextColor="#1a1a1a"/>

                                <RadioButton x:Name="RadioTarjeta" 
                                           Grid.Column="2" 
                                           GroupName="MetodoPagoGroup" 
                                           VerticalOptions="Center"/>
                            </Grid>

                            <BoxView HeightRequest="1" Color="#F0F0F0" Margin="16,0"/>

                            <!-- Deuna -->
                            <Grid x:Name="GridMetodo_Deuna" 
                                  ColumnDefinitions="Auto, *, Auto" 
                                  Padding="16,12">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnMetodoPagoSelected" CommandParameter="Deuna"/>
                                </Grid.GestureRecognizers>

                                <Border x:Name="BorderIcon_Deuna"
                                        WidthRequest="44"
                                        HeightRequest="44"
                                        StrokeShape="RoundRectangle 12"
                                        BackgroundColor="#F8F8F8"
                                        Stroke="#E8E8E8"
                                        StrokeThickness="1">
                                    <Image Source="deuna_logo.png" 
                                           HeightRequest="24" 
                                           WidthRequest="24"/>
                                </Border>

                                <Label x:Name="LabelDeuna" 
                                       Grid.Column="1" 
                                       Text="Deuna!" 
                                       VerticalOptions="Center" 
                                       Margin="14,0"
                                       FontSize="15"
                                       TextColor="#1a1a1a"/>

                                <RadioButton x:Name="RadioDeuna" 
                                           Grid.Column="2" 
                                           GroupName="MetodoPagoGroup" 
                                           VerticalOptions="Center"/>
                            </Grid>

                            <BoxView HeightRequest="1" Color="#F0F0F0" Margin="16,0"/>

                            <!-- Transferencia Bancaria -->
                            <Grid x:Name="GridMetodo_Transfer" 
                                  ColumnDefinitions="Auto, *, Auto" 
                                  Padding="16,12">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnMetodoPagoSelected" CommandParameter="Transferencia"/>
                                </Grid.GestureRecognizers>

                                <Border x:Name="BorderIcon_Transfer"
                                        WidthRequest="44"
                                        HeightRequest="44"
                                        StrokeShape="RoundRectangle 12"
                                        BackgroundColor="#F0F7FF"
                                        Stroke="#D9EBFF"
                                        StrokeThickness="1">
                                    <Label FontFamily="FASolid" 
                                           Text="&#xf19c;" 
                                           TextColor="#004A99" 
                                           FontSize="20"
                                           HorizontalOptions="Center" 
                                           VerticalOptions="Center"/>
                                </Border>

                                <Label x:Name="LabelTransfer" 
                                       Grid.Column="1" 
                                       Text="Transferencia Bancaria" 
                                       VerticalOptions="Center" 
                                       Margin="14,0"
                                       FontSize="15"
                                       TextColor="#1a1a1a"/>

                                <RadioButton x:Name="RadioTransfer" 
                                           Grid.Column="2" 
                                           GroupName="MetodoPagoGroup" 
                                           VerticalOptions="Center"/>
                            </Grid>

                            <BoxView HeightRequest="1" Color="#F0F0F0" Margin="16,0"/>

                            <!-- Efectivo -->
                            <Grid x:Name="GridMetodo_Efectivo" 
                                  ColumnDefinitions="Auto, *, Auto" 
                                  Padding="16,12">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnMetodoPagoSelected" CommandParameter="Efectivo"/>
                                </Grid.GestureRecognizers>

                                <Border x:Name="BorderIcon_Efectivo"
                                        WidthRequest="44"
                                        HeightRequest="44"
                                        StrokeShape="RoundRectangle 12"
                                        BackgroundColor="#F0FFF4"
                                        Stroke="#D9F7E0"
                                        StrokeThickness="1">
                                    <Label FontFamily="FASolid" 
                                           Text="&#xf0d6;" 
                                           TextColor="#228B22" 
                                           FontSize="20"
                                           HorizontalOptions="Center" 
                                           VerticalOptions="Center"/>
                                </Border>

                                <Label x:Name="LabelEfectivo" 
                                       Grid.Column="1" 
                                       Text="Efectivo" 
                                       VerticalOptions="Center" 
                                       Margin="14,0"
                                       FontSize="15"
                                       TextColor="#1a1a1a"/>

                                <RadioButton x:Name="RadioEfectivo" 
                                           Grid.Column="2" 
                                           GroupName="MetodoPagoGroup" 
                                           VerticalOptions="Center"/>
                            </Grid>

                            <BoxView HeightRequest="1" Color="#F0F0F0" Margin="16,0"/>

                            <!-- Agregar nueva tarjeta -->
                            <Grid x:Name="GridMetodo_Agregar" 
                                  ColumnDefinitions="Auto, *" 
                                  Padding="16,12">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnMetodoPagoSelected" CommandParameter="Agregar"/>
                                </Grid.GestureRecognizers>

                                <Border x:Name="BorderIcon_Agregar"
                                        WidthRequest="44"
                                        HeightRequest="44"
                                        StrokeShape="RoundRectangle 12"
                                        BackgroundColor="#F8F8F8"
                                        Stroke="#E8E8E8"
                                        StrokeThickness="1"
                                        StrokeDashArray="4,4">
                                    <Label FontFamily="FASolid" 
                                           Text="&#xf055;" 
                                           TextColor="{StaticResource AlVueloRed}" 
                                           FontSize="20"
                                           HorizontalOptions="Center" 
                                           VerticalOptions="Center"/>
                                </Border>

                                <Label x:Name="LabelAgregar" 
                                       Grid.Column="1" 
                                       Text="Agregar nueva tarjeta" 
                                       VerticalOptions="Center" 
                                       Margin="14,0"
                                       FontSize="15"
                                       TextColor="#666666"/>
                            </Grid>
                        </VerticalStackLayout>
                    </Border>
                </VerticalStackLayout>

                <!-- Espacio inferior -->
                <BoxView HeightRequest="20" Color="Transparent"/>
            </VerticalStackLayout>
        </ScrollView>

        <!-- BOTÓN PAGAR FIJO -->
        <Border Grid.Row="2"
                Padding="20,12,20,20"
                StrokeThickness="0"
                Shadow="{Shadow Brush=Black, Offset='0,-2', Radius=12, Opacity=0.08}">
            <Grid HeightRequest="56">
                <Button x:Name="BtnPagar"
                        Text="Confirmar y Pagar" 
                        BackgroundColor="{StaticResource AlVueloDarkRed}"
                        TextColor="White"
                        CornerRadius="14"
                        FontAttributes="Bold"
                        FontSize="17"
                        Clicked="OnPagarClicked"
                        Shadow="{Shadow Brush={StaticResource AlVueloDarkRed}, Offset='0,4', Radius=12, Opacity=0.3}"/>

                <ActivityIndicator x:Name="SpinnerCarga"
                                   IsRunning="False"
                                   IsVisible="False"
                                   Color="White"
                                   WidthRequest="32"
                                   HeightRequest="32"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>
            </Grid>
        </Border>

        <!-- LOADING OVERLAY -->
        <Grid x:Name="LoadingOverlay"
              Grid.RowSpan="3"
              BackgroundColor="#CC000000"
              IsVisible="False"
              HorizontalOptions="Fill"
              VerticalOptions="Fill">
            <Border Padding="35"
                    BackgroundColor="White"
                    StrokeShape="RoundRectangle 20"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    WidthRequest="220">
                <VerticalStackLayout Spacing="18" HorizontalOptions="Center">
                    <ActivityIndicator IsRunning="True" 
                                       Color="{StaticResource AlVueloRed}"
                                       WidthRequest="44"
                                       HeightRequest="44"/>
                    <Label Text="Procesando pago..." 
                           TextColor="#1a1a1a" 
                           FontAttributes="Bold"
                           FontSize="16"
                           HorizontalTextAlignment="Center"/>
                    <Label Text="Por favor espera un momento"
                           TextColor="#666666"
                           FontSize="13"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>
            </Border>
        </Grid>
    </Grid>
</ContentPage>