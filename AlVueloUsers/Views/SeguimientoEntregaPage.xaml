<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
             x:Class="AlVueloUsers.Views.SeguimientoEntregaPage"
             BackgroundColor="White"
             NavigationPage.HasNavigationBar="False">

    <Grid>
        <maps:Map x:Name="MapaSeguimiento"
                  IsShowingUser="True"
                  MapType="Street"
                  IsScrollEnabled="True"
                  IsZoomEnabled="True"
                  VerticalOptions="Fill"
                  HorizontalOptions="Fill" />

        <Grid RowDefinitions="Auto, *, Auto"
              InputTransparent="True"
              CascadeInputTransparent="False">

            <Border Grid.Row="0"
                    InputTransparent="False"
                    BackgroundColor="White"
                    Padding="20,15"
                    Margin="15,50,15,0"
                    StrokeShape="RoundRectangle 20"
                    StrokeThickness="0"
                    Shadow="{Shadow Brush=Black, Offset='0,4', Radius=15, Opacity=0.15}">
                <Grid RowDefinitions="Auto, Auto, Auto" ColumnDefinitions="Auto, *">

                    <Border Grid.Row="0" Grid.Column="0" Grid.RowSpan="3"
                            WidthRequest="60"
                            HeightRequest="60"
                            StrokeShape="RoundRectangle 30"
                            BackgroundColor="{StaticResource AlVueloRed}"
                            Margin="0,0,15,0"
                            VerticalOptions="Center">
                        <Label FontFamily="FASolid" 
                               Text="&#xf21c;" 
                               TextColor="White"
                               FontSize="28"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
                    </Border>

                    <Label Grid.Row="0" Grid.Column="1"
                           x:Name="LabelEstado"
                           Text="Pepito está en camino"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="#1a1a1a"
                           VerticalOptions="End"/>

                    <Label Grid.Row="1" Grid.Column="1"
                           x:Name="LabelDescripcionEstado"
                           Text="ABC-123 • Rojo"
                           FontSize="14"
                           TextColor="#666666"
                           Margin="0,2,0,0"/>

                    <HorizontalStackLayout Grid.Row="2" Grid.Column="1" Spacing="5" Margin="0,8,0,0">
                        <Label FontFamily="FASolid" 
                               Text="&#xf017;" 
                               TextColor="{StaticResource AlVueloRed}"
                               FontSize="14"
                               VerticalOptions="Center"/>
                        <Label x:Name="LabelTiempoEstimado"
                               Text="17:50 - 18:10"
                               FontSize="14"
                               FontAttributes="Bold"
                               TextColor="{StaticResource AlVueloRed}"
                               VerticalOptions="Center"/>
                        <Label Text="•"
                               TextColor="#999999"
                               FontSize="14"
                               VerticalOptions="Center"
                               Margin="3,0"/>
                        <Label x:Name="LabelDistancia"
                               Text="2.3 km"
                               FontSize="14"
                               TextColor="#999999"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>
                </Grid>
            </Border>

            <Grid Grid.Row="1"/>

            <Border Grid.Row="2"
                    x:Name="BottomSheet"
                    InputTransparent="False"
                    BackgroundColor="White"
                    Padding="0"
                    StrokeShape="RoundRectangle 30,30,0,0"
                    StrokeThickness="0"
                    Shadow="{Shadow Brush=Black, Offset='0,-4', Radius=20, Opacity=0.1}">

                <Grid RowDefinitions="Auto, Auto">

                    <Grid Grid.Row="0" HeightRequest="30" BackgroundColor="Transparent" VerticalOptions="Start">
                        <BoxView WidthRequest="40"
                                 HeightRequest="4"
                                 Color="#D0D0D0"
                                 CornerRadius="2"
                                 VerticalOptions="Center"
                                 HorizontalOptions="Center"/>

                        <Grid.GestureRecognizers>
                            <PanGestureRecognizer PanUpdated="OnBottomSheetPan"/>
                        </Grid.GestureRecognizers>
                    </Grid>

                    <VerticalStackLayout Grid.Row="1" Spacing="20" Padding="25,0,25,40">

                        <VerticalStackLayout Spacing="12">
                            <HorizontalStackLayout Spacing="8">
                                <Label FontFamily="FASolid" 
                                       Text="&#xf084;" 
                                       TextColor="{StaticResource AlVueloRed}"
                                       FontSize="18"
                                       VerticalOptions="Center"/>
                                <Label Text="PIN de Entrega"
                                       Style="{StaticResource SectionHeaderStyle}"
                                       VerticalOptions="Center"/>
                            </HorizontalStackLayout>

                            <Label Text="Muestra este código al repartidor cuando llegue."
                                   FontSize="13"
                                   TextColor="#888888"
                                   Margin="0,0,0,5"/>

                            <HorizontalStackLayout Spacing="12" HorizontalOptions="Center" Margin="0,5">
                                <Border Style="{StaticResource PinBoxStyle}" BackgroundColor="#FFF5F5" StrokeThickness="2" Stroke="{StaticResource AlVueloRed}">
                                    <Label x:Name="PinDigit1" Text="-" Style="{StaticResource PinDigitStyle}" TextColor="{StaticResource AlVueloRed}" FontSize="32" FontAttributes="Bold"/>
                                </Border>
                                <Border Style="{StaticResource PinBoxStyle}" BackgroundColor="#FFF5F5" StrokeThickness="2" Stroke="{StaticResource AlVueloRed}">
                                    <Label x:Name="PinDigit2" Text="-" Style="{StaticResource PinDigitStyle}" TextColor="{StaticResource AlVueloRed}" FontSize="32" FontAttributes="Bold"/>
                                </Border>
                                <Border Style="{StaticResource PinBoxStyle}" BackgroundColor="#FFF5F5" StrokeThickness="2" Stroke="{StaticResource AlVueloRed}">
                                    <Label x:Name="PinDigit3" Text="-" Style="{StaticResource PinDigitStyle}" TextColor="{StaticResource AlVueloRed}" FontSize="32" FontAttributes="Bold"/>
                                </Border>
                                <Border Style="{StaticResource PinBoxStyle}" BackgroundColor="#FFF5F5" StrokeThickness="2" Stroke="{StaticResource AlVueloRed}">
                                    <Label x:Name="PinDigit4" Text="-" Style="{StaticResource PinDigitStyle}" TextColor="{StaticResource AlVueloRed}" FontSize="32" FontAttributes="Bold"/>
                                </Border>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>

                        <VerticalStackLayout Spacing="15">
                            <Label Text="Estado del Pedido" FontSize="16" FontAttributes="Bold" TextColor="#1a1a1a"/>

                            <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto, Auto" ColumnSpacing="0">
                                <BoxView Grid.Row="0" Grid.ColumnSpan="3" HeightRequest="3" Color="#E0E0E0" VerticalOptions="Center" Margin="30,30" CornerRadius="15"/>
                                <BoxView Grid.Row="0" Grid.ColumnSpan="2" x:Name="ProgressLine" HeightRequest="3" Color="{StaticResource AlVueloRed}" VerticalOptions="Center" Margin="30,30" HorizontalOptions="Start" WidthRequest="200" CornerRadius="15"/>

                                <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="15">
                                    <Border WidthRequest="24" HeightRequest="24" StrokeShape="Ellipse" BackgroundColor="{StaticResource AlVueloRed}" HorizontalOptions="Center" Stroke="{StaticResource AlVueloRed}" StrokeThickness="3">
                                        <Label FontFamily="FASolid" Text="&#xf00c;" TextColor="White" FontSize="10" HorizontalOptions="Center" VerticalOptions="Center"/>
                                    </Border>
                                    <Label Text="Confirmado" FontSize="11" TextColor="#1a1a1a" HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                </VerticalStackLayout>

                                <VerticalStackLayout Grid.Row="0" Grid.Column="1" Spacing="15">
                                    <Border x:Name="Step2Circle" WidthRequest="24" HeightRequest="24" StrokeShape="Ellipse" BackgroundColor="{StaticResource AlVueloRed}" HorizontalOptions="Center" Stroke="{StaticResource AlVueloRed}" StrokeThickness="3">
                                        <Label FontFamily="FASolid" Text="&#xf0d1;" TextColor="White" FontSize="10" HorizontalOptions="Center" VerticalOptions="Center"/>
                                    </Border>
                                    <Label Text="En camino" FontSize="11" TextColor="{StaticResource AlVueloRed}" HorizontalTextAlignment="Center" FontAttributes="Bold"/>
                                </VerticalStackLayout>

                                <VerticalStackLayout Grid.Row="0" Grid.Column="2" Spacing="15">
                                    <Border WidthRequest="24" HeightRequest="24" StrokeShape="Ellipse" BackgroundColor="White" HorizontalOptions="Center" Stroke="#E0E0E0" StrokeThickness="3">
                                        <Label FontFamily="FASolid" Text="&#xf3c5;" TextColor="#999999" FontSize="10" HorizontalOptions="Center" VerticalOptions="Center"/>
                                    </Border>
                                    <Label Text="Entregado" FontSize="11" TextColor="#999999" HorizontalTextAlignment="Center"/>
                                </VerticalStackLayout>
                            </Grid>
                        </VerticalStackLayout>

                        <Grid ColumnDefinitions="*, *" ColumnSpacing="12" Margin="0,10,0,0">
                            <Border Grid.Column="0" BackgroundColor="White" Stroke ="{StaticResource AlVueloRed}" Padding="15" StrokeShape="RoundRectangle 12" StrokeThickness="1">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnLlamarClicked"/>
                                </Border.GestureRecognizers>
                                <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                    <Label FontFamily="FASolid" Text="&#xf095;" TextColor="{StaticResource AlVueloRed}" FontSize="16" VerticalOptions="Center"/>
                                    <Label Text="Llamar" FontSize="15" FontAttributes="Bold" TextColor="{StaticResource AlVueloRed}" VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                            </Border>

                            <Border Grid.Column="1" BackgroundColor="{StaticResource AlVueloRed}" Padding="15" StrokeShape="RoundRectangle 12" StrokeThickness="0">
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnHomeClicked"/>
                                </Border.GestureRecognizers>
                                <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
                                    <Label FontFamily="FASolid" Text="&#xf015;" TextColor="White" FontSize="16" VerticalOptions="Center"/>
                                    <Label Text="Inicio" FontSize="15" FontAttributes="Bold" TextColor="White" VerticalOptions="Center"/>
                                </HorizontalStackLayout>
                            </Border>
                        </Grid>
                    </VerticalStackLayout>
                </Grid>
            </Border>
        </Grid>

        <Grid x:Name="LoadingOverlay"
              BackgroundColor="#CC000000"
              IsVisible="False"
              HorizontalOptions="Fill"
              VerticalOptions="Fill">
            <Border Padding="30"
                    BackgroundColor="White"
                    StrokeShape="RoundRectangle 20"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    WidthRequest="200">
                <VerticalStackLayout Spacing="15" HorizontalOptions="Center">
                    <ActivityIndicator IsRunning="True" 
                                       Color="{StaticResource AlVueloRed}"
                                       WidthRequest="40"
                                       HeightRequest="40"/>
                    <Label Text="Cargando ruta..."
                           TextColor="#666666"
                           FontSize="14"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>
            </Border>
        </Grid>
    </Grid>
</ContentPage>